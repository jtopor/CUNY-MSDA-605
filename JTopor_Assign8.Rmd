---
title: "CUNY MSDA 605 Spring 2016 Assignment 8"
author: "James Topor"
output: html_document
---


```{r, echo = FALSE, warnings=FALSE, messages=FALSE}
suppressWarnings(suppressMessages(library(gRain)))
```

# -----------------------------------------------------------------------------
### Problem Set 1  

*Your colleague either commutes by train or by the bus. 20 days of the month, she takes the train and the remaining 10 days she takes the bus. If she takes the train, she reaches work on time with a probability of 0.9. If she takes the bus, she frequently gets stuck in traffic and reaches work on time with a probability of 0.5. Given that she was on time today, what is the probability that she took the bus to work today?*

We first calculate the probability that she took each mode of transportation:

P(train) = 20/30 days = .67
```{r}
pTrain <- 20/30
pTrain
```

P(bus) = 10/30 = .33
```{r}
pBus <- 10/30
pBus
```

Then we calculate the probability of arriving on time given the probability of taking each mode of transport:

P(On time | Train) =  .9 * pTrain = .60
```{r}
pTrain_OT <- .9 * pTrain
pTrain_OT
```

P(On time | Bus) = .5  * pBus = .1667
```{r}
pBus_OT <- .5 * pBus
pBus_OT
```

Then we can add the two separate probabilities of on-time arrival to derive the overall probability of arriving on time:

P(On time) = P(On time | Train) + P(On time | Bus) = .60 + .17 = .7667
```{r}
p_OT <- pTrain_OT + pBus_OT
p_OT
```

Finally, knowing the overall probability of an on-time arrival, we can calculate the probability that she took the bus if we know she arrived on time by dividing the probability of an on-time arrival via bus by the overall probability of an on-time arrival:

P(took bus | On Time) = .1667/.7667 = .2173913
```{r}
pBus_OT / p_OT
```

So given that she was on time today, the probability that she took the bus to work is __.2173913__

# -----------------------------------------------------------------------------
### Problem Set 2  

*Use the rGrain package to develop a Bayesian Network that describes the relationship between course difficulty, SAT scores, intelligence, and letters of recommendation.*

# - - - - - - - - - - - - - - - - 
__Citation__  
The R code used here was constructed using both the 605 Class Lecture Slides:

__"Lecture 4 slides 3.15.2016 Bayes.pdf"__ written by Giri Iyengar 

and from the following document:  

__"Bayesian networks in R with the gRain package"__  
Author: Soren Hojsgaard, Aalborg University, Denmark  

This document can be found at the following web link:  
https://cran.r-project.org/web/packages/gRain/vignettes/gRain-intro.pdf

Specifically, we are relying on the sample code provided in Sections 3.1 and 3.2 of that PDF. 

# - - - - - - - - - - - - - - - - 

We'll make use of the probabilities show in the diagram on page 3 of the Week 8 Lecture Notes to create the required Bayesian network. The __gRain__ package's __cptable__ and __compileCPT__ functions are invoked with the appropriate probabilities corresponding to each of the nodes shown in the diagram.

```{r, warnings=FALSE, messages=FALSE}

lo.hi <- c("low", "high")
no.yes <- c("no", "yes")

# ------------------------------------------
# Specify conditional probability tables

# define probs of difficult course: no = .3, yes = .7
diff <- cptable(~diff, values = c(.3, .7), levels = no.yes) 

# define prob of intellegence: low = .8, high = .2
intel <- cptable(~intel, values = c(.8, .2), levels = lo.hi) 

# define prob of grade given difficulty w/ course AND intelligence
grade.diff_intel <- cptable(~grade|diff+intel, values = c(.6, .4, .8, .2, .01, .99, .1, .9), levels = lo.hi)

# define prob of SAT score given intelligence
sat.intel <- cptable(~sat|intel, values = c(.9, .1, .2, .8), levels = lo.hi)

# define prob of favorable letter of recommendation given grade
letter.grade <- cptable(~letter|grade, values = c(.9, .1, .05, .95), levels = lo.hi)

# ------------------------------------------
##### Compile list of conditional probability tables and create the network

plist <- compileCPT(list(diff, intel, grade.diff_intel, sat.intel, letter.grade))

# display the list of compiled conditional probabilities
plist
```


Next we'll display the compiled conditional probabilities to ensure they match those given in the diagram. This is a good validation step since it is very easy to confuse the required ordering of probabilities submitted to the __cptable__ function:

```{r}

# display the probability of difficulty
plist$diff

# display the probability of intelligence
plist$intel

# display the conditional probabilities for "grade" 
plist$grade

# display the conditional probability for SAT score
plist$sat

# display the conditional probability for SAT score
plist$letter
```

All of the computed conditional probabilities appear to match those of the diagram. Therefore, we can now build the required graphical independence network:

```{r}
net1 <-grain(plist)
plot(net1)
```


# ------------------------------
__*What happens to the probability of Difficulty of Course when you present the evidence that the received recommendation letter was good?*__  

First, let's check the probability of having difficulty with the course when we do not know that the letter of recommendation was good. We can do this by invoking the __querygrain__ function with the *type* variable set to 'marginal':
```{r}
# Prob of difficulty w/ no info on letter of recommendation
querygrain(net1, nodes=c("diff"), type="marginal")
```

We estimate that there will be a 0.3 probability of having no difficulty with the course when we have no information regarding the letter of recommendation. This matches the probability given to us in the original diagram.

Now let's see what happens when the additional information regarding the letter of recommendation being "good" is considered. We'll use the __setEvidence__ function to first introduce the additional information regarding the letter of recommendation being "good" to our network. Then we again invoke the __querygrain__ function with the *type* variable set to 'marginal':
```{r}
# Present evidence that letter of recommendation was positive
net12 <- setEvidence(net1, evidence = list(letter = "high"))

# Estimate new probability of difficulty given info about letter
querygrain(net12, nodes=c("diff"), type="marginal")
```

The additional information about the letter of recommendation being positive decreases the probability that the student will have difficulty with the course from .70 to .6268

# ------------------------------  
__*In addition, now present the evidence that both SAT scores were good and the letter of recommendation was good, What is the probability of the Difficulty of Course now?*__

We'll use the __setEvidence__ function to first introduce the additional information that both the letter of recommendation and the SAT scores were "good" to our network. Then we invoke the __querygrain__ function with the *type* variable set to 'marginal':

```{r}
# Present evidence that both SAT score AND letter of recommendation were good
net13 <- setEvidence(net1, evidence = list(letter = "high", sat = "high"))

# Estimate new probability of difficulty given info about letter
querygrain(net13, nodes=c("diff"), type="marginal")
```

The additional information about the letter of recommendation being positive has decreased the probability that the student will have difficulty with the course from .70 to .667. Therefore, the information regarding the SAT score combined with the information on the letter of recommendation doesn't seem to improve upon the the result we obtained above using the additional information about the letter of recommendation alone. 